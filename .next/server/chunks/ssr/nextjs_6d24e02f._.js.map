{"version":3,"sources":["../../../../../nextjs/entities/checkout/hooks/useMidtransPayment.ts","../../../../../nextjs/features/_protected/_transactionsPage/components/TabsTransactions/CardItemTransasction/CartTransactionItem.Actions.tsx"],"sourcesContent":["\"use client\";\r\nimport useMidtransScript from \"@/hooks/useMidtransScript\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { useCallback, useState } from \"react\";\r\nimport { toast } from \"sonner\";\r\n\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n// type MidtransPaymentType = {\r\n//   onSuccessCallback?: (result: any, order_id?: string) => void;\r\n//   onErrorCallback?: (error: any) => void;\r\n//   onCloseCallback?: () => void;\r\n// };\r\n\r\nexport default function useMidtransPayment() {\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const router = useRouter();\r\n  const queryClient = useQueryClient();\r\n  // const { isLoaded: isSnapLoaded } = useMidtransScript();\r\n\r\n  const initiatePayment = useCallback(\r\n    (snapToken: string, order_id?: string) => {\r\n      // if (!isSnapLoaded) {\r\n      //   return Promise.reject(new Error(\"Loading snap. Please wait.\"));\r\n      // }\r\n\r\n      if (!window.snap) {\r\n        // onErrorCallback?.(new Error(\"Snap not loaded\"));\r\n        return Promise.reject(new Error(\"Snap not ready yet.\"));\r\n      }\r\n\r\n      setIsProcessing(true);\r\n\r\n      return new Promise<void>((resolve, reject) => {\r\n        window.snap.pay(snapToken, {\r\n          onSuccess: (result) => {\r\n            setIsProcessing(false);\r\n            // onSuccessCallback?.(result, order_id);\r\n\r\n            router.replace(`/checkout/success?order_id=${order_id}`);\r\n            toast.success(\"Payment Successfull\", {\r\n              position: \"top-right\",\r\n              richColors: true,\r\n              onAutoClose: () => {\r\n                router.replace(`/checkout/success?order_id=${order_id}`);\r\n                queryClient.invalidateQueries({ queryKey: [\"transactions\"] });\r\n              },\r\n            });\r\n            resolve();\r\n          },\r\n          onError: (result) => {\r\n            setIsProcessing(false);\r\n            // onErrorCallback?.(result);\r\n\r\n            console.error(\"ðŸš€ ~ BillingDetails ~ error:\", result);\r\n            toast.error(\"Payment failed. Please try again.\", {\r\n              position: \"top-right\",\r\n              richColors: true,\r\n            });\r\n\r\n            router.replace(\"/user/transactions\");\r\n\r\n            reject(result);\r\n          },\r\n          onClose: () => {\r\n            setIsProcessing(false);\r\n            // onCloseCallback?.();\r\n\r\n            toast.info(\r\n              \"Payment not completed. You can continue payment in your transaction page.\",\r\n              {\r\n                position: \"top-right\",\r\n              },\r\n            );\r\n\r\n            router.replace(\"/user/transactions\");\r\n            // reject(new Error(\"You're closing the payment pop up\"));\r\n          },\r\n        });\r\n      });\r\n    },\r\n    [router, queryClient],\r\n  );\r\n\r\n  return { initiatePayment, isProcessing };\r\n}\r\n","\"use client\";\r\n\r\nimport { Button } from \"@/components/ui/button\";\r\nimport useMidtransPayment from \"@/entities/checkout/hooks/useMidtransPayment\";\r\nimport { TransactionType } from \"@/entities/transactions/types/transaction.type\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Loader2 } from \"lucide-react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { Activity } from \"react\";\r\n\r\ntype CardTransactionItemActionsProps = {\r\n  transaction?: TransactionType | undefined;\r\n};\r\n\r\nconst CardTransactionItemActions: React.FC<CardTransactionItemActionsProps> = ({\r\n  transaction,\r\n}) => {\r\n  const router = useRouter();\r\n  const { initiatePayment, isProcessing } = useMidtransPayment();\r\n  const status = transaction?.status;\r\n\r\n  const handlePay = async () => {\r\n    if (status !== \"pending\" || !transaction?.snap_token) return;\r\n\r\n    await initiatePayment(transaction.snap_token, transaction.order_id);\r\n  };\r\n\r\n  const isDisabled = isProcessing;\r\n\r\n  return (\r\n    <div className=\"font-geist xs:flex-row inline-flex w-full flex-1 flex-col items-center justify-end gap-4 overflow-hidden\">\r\n      {/* SHOW PAY NOW WHEN STATUS PENDING */}\r\n      <Activity mode={status === \"pending\" ? \"visible\" : \"hidden\"}>\r\n        <Button\r\n          onClick={handlePay}\r\n          disabled={isDisabled}\r\n          className={cn(\r\n            \"bg-baraka-primary-300 xs:inline-flex xs:min-w-40 min-w-full cursor-pointer items-center justify-center rounded-none\",\r\n            isDisabled && \"cursor-wait\",\r\n          )}\r\n        >\r\n          {isDisabled ? <Loader2 className=\"animate-spin\" /> : \"Pay Now\"}\r\n        </Button>\r\n      </Activity>\r\n\r\n      {/* SHOW WHEN STATUS PAID */}\r\n\r\n      <Activity mode={status === \"paid\" ? \"visible\" : \"hidden\"}>\r\n        <Button className=\"bg-baraka-primary-300 hover:bg-baraka-lightgreen-200 xs:min-w-40 min-w-full cursor-pointer rounded-none hover:text-white\">\r\n          Rate Product\r\n        </Button>\r\n      </Activity>\r\n\r\n      <Activity\r\n        mode={\r\n          status === \"paid\" || status === \"expire\" || status === \"canceled\"\r\n            ? \"visible\"\r\n            : \"hidden\"\r\n        }\r\n      >\r\n        <Button\r\n          onClick={() => router.push(\"/store\", { scroll: false })}\r\n          variant={status !== \"pending\" ? \"outline\" : \"default\"}\r\n          className={cn(\r\n            \"xs:min-w-40 min-w-full cursor-pointer rounded-none\",\r\n            status === \"pending\" || status === \"expire\"\r\n              ? \"bg-baraka-primary-300 hover:bg-baraka-lightgreen-200 text-white hover:text-white\"\r\n              : \"border-baraka-primary-300\",\r\n          )}\r\n        >\r\n          Buy Again\r\n        </Button>\r\n      </Activity>\r\n\r\n      {/* SHOW CANCEL BUTTON WHEN STATUS PENDING */}\r\n      <Activity mode={status === \"pending\" ? \"visible\" : \"hidden\"}>\r\n        <Button\r\n          className=\"xs:min-w-40 min-w-full cursor-pointer rounded-none border-red-500\"\r\n          variant={\"outline\"}\r\n        >\r\n          Cancel\r\n        </Button>\r\n      </Activity>\r\n\r\n      {/* END SHOW WHEN STATUS PAID */}\r\n      {/* <Activity mode={status !== \"expire\" ? \"visible\" : \"hidden\"}>\r\n        <HoverCard openDelay={1} closeDelay={1}>\r\n          <HoverCardTrigger asChild>\r\n            <Button\r\n              variant={\"outline\"}\r\n              className=\"border-baraka-primaxs:min-w-40 min-w-full w-full  rounded-none\"\r\n            >\r\n              OTHER\r\n            </Button>\r\n          </HoverCardTrigger>\r\n\r\n          <HoverCardContent sideOffset={0} className=\"rounded-xs p-1 text-left\">\r\n            \r\n\r\n            <Activity mode={status === \"paid\" ? \"visible\" : \"hidden\"}>\r\n              <Button\r\n                className=\"xs:min-w-40 min-w-full w-full  cursor-pointer rounded-none\"\r\n                variant={\"ghost\"}\r\n              >\r\n                Rate Product\r\n              </Button>\r\n            </Activity>\r\n          </HoverCardContent>\r\n        </HoverCard>\r\n      </Activity> */}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CardTransactionItemActions;\r\n"],"names":[],"mappings":"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"}